/_ File: 13.2-frontend-twaling-library-config.md Purpose: Task plan to port
legacy UI components (oldRepo/boops-site/app/src/ui) into the new Poetry
frontend following Tailwind token, theming, i18n, a11y, DDD, and formatting
rules. Includes integration of themes, colors, and fonts provided by the
backend, full token centralization, and decoupled customization. All Rights
Reserved. _/

# Task 13.2 Frontend Tailwind UI Library Config & Migration

**Goal:** Migrate legacy components 'oldRepo\boops-site\app\src\features\theme'
&& 'oldRepo\boops-site\app\src\ui' to `poetry-frontend/src/ui/` as a
foundational UI library with fully decoupled, combinable customization of colors
(10 themes x 12 colors), fonts (at least 3, available offline), font sizes,
spacings, radii, and shadows. The system must be 100% token-driven, accessible,
i18n-ready, free from business logic and hardcoded styles/text, with files <80
lines, and all tokens downloaded and centralized from the backend.

---

## 0. Backend Tokens & Customization Integration Prep

- [ ] Backend must expose a `/health` endpoint with a `getTokens` method that
      returns each customization as a **separate group**:
  - **themes:** 10 color themes, each with 12 named colors (e.g. primary,
    secondary, accent, info, warning, error, success, surface, background,
    border, muted, text).
  - **fonts:** at least 3 fonts, each with:
    - key, label, direct URL to font file (woff2/ttf preferred), hash/version,
      available weights.
    - Font files must be downloadable and registerable for offline use (open
      CORS or embedded binary).
  - **fontSizes:** at least 5 sizes (xs, sm, base, lg, xl), each set identified
    by key (e.g. `default`, `compact`, `spacious`).
  - **fontWeights:** global set (normal, medium, bold).
  - **spacings:** named sets for spacing (xs, sm, md, lg, xl), each set
    identified by key.
  - **radius:** sets of border-radius (sm, md, lg), each identified by key.
  - **shadows:** sets of shadows (sm, md, lg), each identified by key.
- [ ] Backend must support independent updates for color theme, font, font size
      set, spacing set, radius set, and shadow set. The frontend never defines
      or alters these sets, only consumes those that are selected and available.
- [ ] Backend must expose the currently selected value for each type (e.g.
      currentTheme, currentFont, currentSpacing, etc).
- [ ] Document the `getTokens` contract and how each active customization is
      retrieved and selected.

**Example payload for `getTokens`:**

```json
{
  "themes": [
    { "key": "default", "label": "Default", "colors": { "primary": "#4f46e5", ... } },
    { "key": "dark", "label": "Dark", "colors": { "primary": "#22223b", ... } }
    // ...total 10 themes
  ],
  "fonts": [
    {
      "key": "Inter",
      "label": "Inter",
      "woff2Url": "https://cdn.myapp.com/fonts/inter.woff2",
      "weights": [400, 500, 700],
      "hash": "sha256-abc123"
    },
    {
      "key": "Roboto",
      "label": "Roboto",
      "woff2Url": "https://cdn.myapp.com/fonts/roboto.woff2",
      "weights": [400, 500, 700],
      "hash": "sha256-def456"
    }
  ],
  "fontSizes": [
    { "key": "default", "label": "Default", "sizes": { "xs": "0.75rem", "sm": "0.875rem", "base": "1rem", "lg": "1.125rem", "xl": "1.25rem" } },
    { "key": "compact", "label": "Compact", "sizes": { ... } }
  ],
  "spacings": [
    { "key": "default", "label": "Default", "values": { "xs": "0.25rem", "sm": "0.5rem", "md": "1rem", "lg": "1.5rem", "xl": "2rem" } },
    { "key": "spacious", "label": "Spacious", "values": { ... } }
  ],
  "radius": [
    { "key": "default", "label": "Default", "values": { "sm": "0.125rem", "md": "0.375rem", "lg": "0.5rem" } }
  ],
  "shadows": [
    { "key": "default", "label": "Default", "values": { "sm": "...", "md": "...", "lg": "..." } }
  ],
  "current": {
    "theme": "default",
    "font": "Inter",
    "fontSize": "default",
    "spacing": "default",
    "radius": "default",
    "shadow": "default"
  }
}
```

---

## 1. Audit Checker

- [ ] Inventory legacy components (Alert, Badge, Button, Card, ...).
- [ ] For each: document props, behaviors, styling patterns, a11y gaps, and i18n
      needs.
- [ ] Flag any direct use of color/font/size/spacing/typography/border/shadow to
      be replaced with centralized tokens from the backend.

## 2. Theming, Tokens & Offline Fonts Checker

- [ ] Define the central tokens mapping in `src/ui/theme/tokens.ts`,
      initializing from the backend payload.
- [ ] On app start, download all declared fonts and store them locally
      (IndexedDB/FileSystem/Cache Storage) by key/hash.
- [ ] Register downloaded fonts using the FontFace API for CSS use even while
      offline.
- [ ] The font selector must only show locally downloaded fonts and must switch
      the global UI font without requiring a connection.
- [ ] Allow dynamic, decoupled selection of color theme, font, font size set,
      spacing set, radius set, shadow set, etc.
- [ ] Consume tokens only from the backend (`getTokens` via SDK).
- [ ] If a font's hash/version changes in the backend, re-download and replace
      it locally.
- [ ] Provide a safe fallback and error detection if a font fails to load.
- [ ] All visual properties must be replaceable via centralized
      tokens/theme/font/spacing.
- [ ] The frontend must never define, update, or persist tokens: only consume
      the current ones from the backend.

## 3. Structure & DDD Checker

- [ ] Create a folder `src/ui/<Component>/` per component (index +
      Component.tsx + types if needed).
- [ ] Only pure presentational logic; side-effects and navigation outside.
- [ ] Central barrel `src/ui/index.ts` exporting stable contracts.
- [ ] Split files >80 lines (`types.ts`, `subparts/*.tsx`).
- [ ] All components must consume only props and centralized tokens.

## 4. i18n Checker

- [ ] No hardcoded labels; replace with `useT()` keys (namespace `ui.*`).
- [ ] Add/merge keys into `shared/i18n/catalog/*/common/ui.ts` (create if
      absent).
- [ ] Fallbacks for optional props strictly via keys.

## 5. Accessibility (a11y) Checker

- [ ] Buttons: proper `type`, focus ring tokens, aria-disabled vs disabled as
      needed.
- [ ] Inputs/Select: associate `id` & `label`, expose `aria-invalid` on error.
- [ ] Modal: role, aria-modal, focus trap placeholder (advanced trap if separate
      task), close button label key.
- [ ] Table: semantic `<thead>/<tbody>`, optional caption via prop + i18n key.
- [ ] Icons: decorative -> `aria-hidden="true"`, informative -> support `title`
      prop.

## 6. Props & Types Checker

- [ ] Strong explicit prop names (no single-letter vars).
- [ ] Export interfaces separately for reuse/testing.
- [ ] No prop accepting raw class fragments for critical styling (allow
      `className` only for layout extensions).

## 7. Testing & Quality Checker

- [ ] Add vitest tests per component (smoke + variant class resolution + a11y
      attrs) in `src/ui/<Component>/__tests__/` (<40 lines each).
- [ ] Validate env & i18n initialization in tests (mock translation hook).
- [ ] ESLint + Prettier conformity (run existing config).
- [ ] Tests must cover theme, font, and other offline token changes, mocking
      absence of internet.

## 8. Documentation Checker

- [ ] Update this file's "Actual Result" section when finished.
- [ ] Create `/docs/domains/ui-library.md` documenting: scope, RFs, data model
      (props), accessibility, i18n, theming (including how tokens/fonts are
      consumed from the backend), and acceptance criteria.
- [ ] Document token integration and decoupling: how tokens are obtained from
      the backend, how they are applied, how each customization type is updated,
      and how user selection is offered.

---

## Expected Result

Fully reusable, theme-aware, 100% token-driven UI component library with
decoupled customization (colors, fonts, sizes, spacings, radii, shadows), fonts
downloaded and available offline, tests, docs, and i18n integration. Frontend
never defines or mutates tokens, only consumes the current set, and everything
works offline once downloaded.

## Actual Result

- Pending.

---

## 9. Partial Completion Notes

- [ ] (In Progress) Decide minimal vertical slice: implement only 2 themes, 1
      font, current selections, omit others initially for contract scaffolding.
- [x] (Done) Add OpenAPI path `/v1/tokens` with schemas: TokenTheme, TokenFont,
      TokenBundle (slice subset) + ETag header.
- [x] (Done) Backend: domain models ColorTheme, FontAsset; service
      TokensQueryService returning static slice; controller GET /api/v1/tokens.
- [x] (Done) Frontend: provisional SDK method getTokens() + Zod schema.
- [x] (Done) Introduced TokensRepository port + InMemoryTokensRepository impl +
      refactored TokensQueryService to depend on abstraction (production-ready,
      no prototype wording).
- [ ] (Next) Add frontend react-query integration + token context provider.
