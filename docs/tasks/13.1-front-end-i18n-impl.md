<!--
File: 13.1-front-end-i18n-impl.md
Purpose: Scalable frontend i18n plan with strict enforcement,
route/breadcrumb readiness, and thousands-of-files growth path.
Missing key = build/CI failure. Tests stay English only. All Rights
Reserved. Arodi Emmanuel
-->

# Task 13.1 â€” Frontend i18n (Scalable, Strict, Route-Ready)

Context

- Backend already returns localized domain / validation / problem messages.
- Frontend must localize ONLY UI strings (never re-translate backend text).
- Must scale to thousands of segmented files with deterministic typing.
- Future tasks (13.2 routing, 19 a11y) need localized routes & breadcrumbs.

Principles

1. Segmented per domain mirroring backend naming (common, layout, route ...).
2. One source of truth per (locale, domain) file cluster (<80 lines each).
3. Deterministic key discovery -> generated union type; no implicit fallback.
4. Missing or extra (locale parity) = CI failure; dev throws immediately.
5. Key pattern: ui.<domain>.<component>.<element>[.<state>|.<variant>].
6. No key = error (never return key-as-message); fail fast philosophy.
7. Pure & DI friendly: provider is only boundary; logic testable standalone.
8. Tests excluded from scan (English literals allowed ONLY in tests).
9. Route + breadcrumb keys live in dedicated route domain & registry.
10. Scripts reproducible / idempotent; no nondeterministic ordering.

Objectives

- Env validation for VITE_DEFAULT_LOCALE (typed, default 'es').
- Catalog tree: src/shared/i18n/catalog/<locale>/<domain>/\*.ts.
- Domains (seed): common, layout, demo, route.
- Route registry exporting structured route objects with i18n key refs.
- Breadcrumb builder consumes registry + i18n (defer render until ready).
- Generator script builds src/shared/i18n/generated/keys.ts (union + helpers).
- Verification script enforces parity, detects duplicates & unused domains.
- Runtime provider: loads all domain modules eagerly (Vite static import) &
  exposes { t, locale, setLocale } with memo, hot reload (dev only).
- t(key, vars?): strict lookup, {{var}} interpolation; arrays -> positional.
- Locale resolution order: backend -> stored -> env -> navigator -> 'es'.
- Error mapper: translate problem detail code ONLY if internal mapping exists;
  never modify backend-provided localized messages.

Scope / Steps

1. Add env schema update + validation (src/shared/config/env.ts). [DONE] 1.1
   Fetch user locale from backend (/v1/me/locale) in provider before ready.
   [DONE]
2. Create catalog structure + initial files (es/en) per seed domain. [DONE]
3. Implement tools/ci/i18n-verify.mjs (parity, duplicates, orphan locale).
   [DONE]
4. Implement tools/ci/i18n-generate-keys.mjs (sorted union, type exports).
   [DONE]
5. Add npm scripts (generate before typecheck / build, verify in CI chain).
   [DONE]
6. Implement provider + context + hooks (useT, useLocale) with strict errors.
   [DONE]
7. Implement route registry (src/shared/routing/routes.ts) referencing keys.
   [DONE]
8. Implement breadcrumb helper (src/shared/routing/breadcrumbs.ts). [DONE]
9. Externalize literals in App.tsx into demo & layout domains. [DONE]
10. Add errorMapper utility (src/shared/i18n/errorMapper.ts). [DONE]
11. Adjust scanner to ignore tests & generated keys file. [DONE]
12. Add unit tests (English only) for t success, missing key throw,
    interpolation, locale switch persistence, verify script parity, routes,
    breadcrumbs, errorMapper. [DONE]
13. Update documentation (this file Actual Result). [DONE]

Acceptance Criteria

- Build fails on: missing key usage, locale parity mismatch, duplicate keys.
- Generated key union provides compile-time safety (typos rejected).
- All UI literals removed from components (except tests).
- Route registry + breadcrumb utilities reference i18n keys only.
- Files <80 lines; no line >80 chars in frontend source code.
- Env var validation enforced at startup.
- Error mapping never mutates backend localized strings.

Actual Result

All acceptance criteria met:

- Strict env validation and backend locale resolution implemented.
- Segmented catalogs with parity enforcement (verify + gen scripts).
- Dev ergonomics via Vite plugin auto key generation & verification.
- All literals in App externalized; scanner excludes tests & generated.
- Route registry and breadcrumb builder referencing i18n keys only.
- Error mapper present (extensible) without altering backend messages.
- Full granular test coverage (all <40 lines) for provider + helpers.
- Keys union regenerated automatically; missing key usage throws.

Status: Complete Last Updated: 2025-08-29

Links

- Backend i18n: ../../poetry-backend/src/main/java/.../I18nConfig.java
- Verify script: ../../tools/ci/i18n-verify.mjs
- Generator script: ../../tools/ci/i18n-generate-keys.mjs
- Scanner: ../../tools/ci/i18n-scan.mjs
